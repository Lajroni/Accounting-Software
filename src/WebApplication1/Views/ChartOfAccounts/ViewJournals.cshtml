@{
    ViewData["Title"] = "ViewJournals";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .First {
        margin-top: 200px;
        display: table-row;
    }

        .First > .addedOn2 {
            display: none;
        }

        .btn-primary{
                background-color: green !important;
            border-color: green !important;
        }
    .Repeat {
    }

        .Repeat > .addedOn, .Repeat > .details {
            display: none;
        }

        .Repeat > .addedOn2 {
            display: block;
        }

    .spacer {
        height: 100px;
    }

</style>
<h2>ViewJournals</h2>

<p>
    <a style="width:150px; margin-right:20px" class="btn btn-primary" href="/chartofaccounts/Journalizing"> Create Journal</a>
    @if (ViewBag.PrevPage != null)
    {
        <a style="width:150px; margin-right:20px" class="btn btn-primary" href="/chartofaccounts/viewjournals?page=@ViewBag.PrevPage&posted=@ViewBag.PostedOnly  "> Previous Page</a>
    }
    @if (ViewBag.NextPage != null)
    {
        <a style="width:150px; margin-right:20px" class="btn btn-primary" href="/chartofaccounts/viewjournals?page=@ViewBag.NextPage&posted=@ViewBag.PostedOnly "> Next Page</a>
    }
    @if (ViewBag.PostedOnly != true)
    {
        <a style="width:150px; margin-right:20px" class="btn btn-primary" href="/chartofaccounts/submitall"> Submit All Journals</a>
        @if (ViewBag.UserType == 1 || ViewBag.UserType == 2)
        {
            <a style="width:150px; margin-right:20px" class="btn btn-primary" href="/chartofaccounts/post?all=true"> Post All Journals</a>
        }
    }
</p>
<table class="table" style="margin-bottom: 0px;">
    <thead>
        <tr>
            <th style="width:200px;">
                Journal ID
            </th>
            <th style="width:160px;">
                Account Name
            </th>
            <th style="width:30px">

            </th>
            <th style="width:100px;text-align: right;"> 
                Debit
            </th>
            <th style="width:60px">

            </th>
            <th style="width:100px;text-align: right;">
                Credit
            </th>
            <th style="width:250px; text-align:center">
                Actions
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

@{ int j = 0; int colors = 0;
@foreach (var item in ViewBag.Transactions)
{
    int i = 0;
    <table class="table" style="margin-bottom: 0px;">
        <tbody>
            
            @foreach (var iteminside in item.Items)
            {
                <tr>
                    <td style="display:none"></td>
                    <td class="addedOn" style="width:200px;">
                        @if (i == 0)
                        {
                            <a href="/chartofaccounts/journalizing?viewonly=true&journalid=@iteminside.JournalId">  @iteminside.JournalId </a>
                        }
                    </td>
                    <td class="addedOn2" style="width:160px;">
                        @if (!iteminside.isDebit)
                        {
                            <a href="/chartofaccounts/accountdetails?accountname=@iteminside.AccountName"> <p>&nbsp; &nbsp; &nbsp; @iteminside.AccountName</p>  </a>
                        }
                        else
                        {
                            <a href="/chartofaccounts/accountdetails?accountname=@iteminside.AccountName"><p>@iteminside.AccountName</p> </a>
                        }
                    </td>
                    <td style="width:30px">
                        $
                    </td>
                    <td style="width:100px; text-align: right;">
                        @if (iteminside.isDebit)
                        {
                            @if (ViewBag.Color[colors] == true)
                            {
                                <p style="color: green"> @Convert.ToDecimal(iteminside.Value).ToString("#,##0.00")</p>
                            }
                            else
                            {
                                <p style="color: red"> @Convert.ToDecimal(iteminside.Value).ToString("#,##0.00") </p>
                            }
                            colors++;
                        }
                    </td>
                    <td style="width:60px;text-align:right">
                        $
                    </td>
                    <td style="width:100px; text-align: right;">
                        @if (!iteminside.isDebit)
                        {
                            @if (ViewBag.Color[colors] == true)
                            {
                                <p style ="color: green" > @Convert.ToDecimal(iteminside.Value).ToString("#,##0.00")</p>
                            }
                            else
                            {
                                <p style="color: red"> @Convert.ToDecimal(iteminside.Value).ToString("#,##0.00") </p>
                            }
                            colors++;
                        }
                    </td>
                    @if (ViewBag.PostedOnly != true)
                    {
                        <td class="details" style="margin-left:30px;  text-align: left; width: 450px;">
                            @if (i == 0)
                        {
                                @if (ViewBag.Submit[j] == 4)
                            {
                                    <p class="alert-success"> APPROVED & POSTED </p>
                                }
                                else if (ViewBag.Submit[j] == 3)
                                {
                                    <p style="display:inline-block" class="alert-danger"> REJECTED! </p>
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/submitall?journalid=@iteminside.JournalId"> Resubmit  </button>
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/journalizing?journalid=@iteminside.JournalId"> Edit </button>
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/delete?journalid=@iteminside.JournalId"> Delete </button>
                                    <p> </p>
                                }
                                else if (ViewBag.Submit[j] == 2)
                                {
                                    if (ViewBag.UserType == 2 || ViewBag.UserType == 1)
                                    {
                                        <p style="display:inline-block" class="alert-info"> Submitted! Ready for approval. </p>
                                        <button  class="btn-primary btn-xs" value="/chartofaccounts/post?journalid=@iteminside.JournalId" onclick="go(this.value,false)"> Post </button>
                                        <button class="btn-primary btn-xs" value="/chartofaccounts/reject?journalid=@iteminside.JournalId" onclick="go(this.value,true)"> Reject </button>
                                        <button  class="btn-primary btn-xs" value="/chartofaccounts/journalizing?journalid=@iteminside.JournalId" onclick="go(this.value,false)"> Edit </button>
                                        <button  class="btn-primary btn-xs" value="/chartofaccounts/delete?journalid=@iteminside.JournalId" onclick="go(this.value,false)"> Delete </button>
                                    }
                                    else
                                    {
                                        <p style="display:inline-block" class="alert-info"> Submitted! Waiting for approval. </p>
                                        <button class="btn-primary btn-xs" value="/chartofaccounts/journalizing?journalid=@iteminside.JournalId"> Edit </button>
                                        <button class="btn-primary btn-xs" value="/chartofaccounts/delete?journalid=@iteminside.JournalId"> Delete </button>
                                    }
                                }
                                else
                                {
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/submitall?journalid=@iteminside.JournalId"> Submit </button>
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/journalizing?journalid=@iteminside.JournalId"> Edit </button>
                                    <button class="btn-primary btn-xs" value="/chartofaccounts/delete?journalid=@iteminside.JournalId"> Delete </button>
                                }
                            }
                        </td>
                    }
                    <td>

                    </td>
                </tr>
                i++;
            }
        </tbody>
    </table>
    <div style="border-top:1px solid black; border-bottom: 1px solid black;">
        <div style="width:30px; text-align: center; display:inline-block; margin-left: 357px">
            $
        </div>
        <div style="width:92px; display:inline-block; text-align: right; border-bottom: 1px solid black;">
            <div style="margin-bottom: 1px; border-bottom: 1px solid black;">
                <p> @Convert.ToDecimal(ViewBag.Totals[(j * 2)]).ToString("#,##0.00") </p>
            </div>
        </div>
        <div style="width:55px; display:inline-block; text-align: right;">
            $
        </div>
        <div style="width:100px; display:inline-block; text-align: right; border-bottom: 1px solid black; margin-bottom: 100px">
            <div style="margin-bottom: 1px; border-bottom: 1px solid black;">
                <p> @Convert.ToDecimal(ViewBag.Totals[(j * 2) + 1]).ToString("#,##0.00") </p>
            </div>
        </div>
    </div>
        j++;
    }
}
@section Scripts {
    <script>
        function go(value){
            window.location.href = value;
        
        }
    </script>
}